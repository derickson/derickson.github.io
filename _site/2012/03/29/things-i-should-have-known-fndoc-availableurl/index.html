<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Things I should have known: fn:doc-available($url) - Front2BackDev</title>
	<meta name="description" content="">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<meta property="og:image" content="">
	<link rel="shortcut icon" href="/assets/img/favicon/favicon.ico" type="image/x-icon">
	<link rel="apple-touch-icon" href="/assets/img/favicon/apple-touch-icon.png">
	<link rel="apple-touch-icon" sizes="72x72" href="/assets/img/favicon/apple-touch-icon-72x72.png">
	<link rel="apple-touch-icon" sizes="114x114" href="/assets/img/favicon/apple-touch-icon-114x114.png">
	<link rel="alternate" type="application/atom+xml" title="Azathought Blog" href="/feed.xml" />
	<!-- Chrome, Firefox OS and Opera -->
	<meta name="theme-color" content="#263959">
	<!-- Windows Phone -->
	<meta name="msapplication-navbutton-color" content="#263959">
	<!-- iOS Safari -->
	<meta name="apple-mobile-web-app-status-bar-style" content="#263959">
	<!-- Google Fonts -->
	<link href="https://fonts.googleapis.com/css?family=PT+Serif:400,700" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Lato:300,400,700" rel="stylesheet">
	<!-- Font Awesome -->
	<link rel="stylesheet" href="/assets/fonts/font-awesome/css/font-awesome.min.css">
	<!-- Styles -->
	<link rel="stylesheet" href="/assets/css/main.css">
</head>

<body>

  <div class="wrapper">


	  <aside class="sidebar">
	  	<header>
	    <div class="about">
	      <div class="cover-author-image">
	        <a href="/"><img src="/assets/img/caricature.png" alt="Dave Erickson"></a>
	      </div>
	      <div class="author-name">Dave Erickson</div>
	      <p>A geek in Washington, DC.</p>

			<div class="navigation">
				<input type="text" class="st-default-search-input page-link">
				<br/>
			
			  
			  	
			  		<a class="page-link tag" href="/archive/">Archive</a>
			  	
				  
			
			  
			
			  
			  	
			  		<a class="page-link tag" href="/tags/">Tags</a>
			  	
				  
			
			  
			  	
				  
			
			  
			  	
				  
			
			  
			
			  
			
			  
			
			  
			
			  
			

			</div>

			 <script type="text/javascript">
			  (function(w,d,t,u,n,s,e){w['SwiftypeObject']=n;w[n]=w[n]||function(){
			  (w[n].q=w[n].q||[]).push(arguments);};s=d.createElement(t);
			  e=d.getElementsByTagName(t)[0];s.async=1;s.src=u;e.parentNode.insertBefore(s,e);
			  })(window,document,'script','//s.swiftypecdn.com/install/v2/st.js','_st');
			  
			  _st('install','yWp_Lhv9nqdDCanwfz6H','2.0.0');
			</script>
	    </div>
	  </header> <!-- End Header -->
	  <footer>
	    <section class="contact">
	      <h3 class="contact-title">Contact me</h3>
	      <ul>
	        
	          <li><a href="https://twitter.com/davebenigno" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a></li>
	        
	        
	        
	        
	      </ul>
	    </section> <!-- End Section Contact -->
	    <div class="copyright">
	      <p>2018 &copy; Dave Erickson</p>
	    </div>
	  </footer> <!-- End Footer -->
		  
	  </aside> <!-- End Sidebar -->

      <div class="content-box clearfix">
  <article class="article-page">
  <div class="page-content">
    
    <div class="wrap-content">
      <header class="header-page">
        <h1 class="page-title">Things I should have known: fn:doc-available($url)</h1>
        <div class="page-date"><span>Mar 29, 2012&nbsp;&nbsp;&nbsp;&nbsp;</span></div>
      </header>
      <p>Sometimes you run across something in a technology or domain that you really should have known long long ago but didn’t.  This is one of those things.  Thank you to the person who pointed it out to me.</p>

<p>fn:exists(fn:doc($url)) causes MarkLogic to pull a fragment from storage to “post-filter” confirm the existence of a document node.  The faster way of doing this is fn:doc-available($url) or xdmp:exists(fn:doc($url)).</p>

<p>xdmp:exists( … ) is basically equivalent to xdmp:estimate( … ) gt 0</p>

<p>The way to confirm for yourself that one has less impact on storage than the other is to turn on xdmp:query trace before running each command.  Compare the MarkLogic error log after running the following</p>

<pre>xquery version "1.0-ml";
xdmp:document-insert( "/1.xml", &lt;a&gt;1&lt;/a&gt;);</pre>

<pre>xquery version "1.0-ml";
xdmp:query-trace(fn:true()),
fn:exists(fn:doc("/1.xml"));</pre>

<pre>xquery version "1.0-ml";
xdmp:query-trace(fn:true()),
fn:doc-available("/1.xml")</pre>

<p>The error log should have something like this:</p>

<pre>Analyzing path: fn:doc("/1.xml")
Step 1 is searchable: fn:doc("/1.xml")
Path is fully searchable.
Gathering constraints.
Step 1 contributed 1 constraint: fn:doc("/1.xml")
Executing search.
<strong>Selected 1 fragment to filter</strong></pre>

<pre>Analyzing path: fn:doc("/1.xml")
Step 1 is searchable: fn:doc("/1.xml")
Path is fully searchable.
Gathering constraints.
Step 1 contributed 1 constraint: fn:doc("/1.xml")
Executing search.</pre>

<p>It’s that “Selected 1 fragment to filter” that tells touching the storage was necessary for fn:exists().  You want to avoid this for most storage solutions.  Interestingly enough, this is true whether or not I turn on the URI Lexicon.</p>

      <div class="page-footer">
        <div class="page-share">
          <a href="https://twitter.com/intent/tweet?text=Things I should have known: fn:doc-available($url)&url=http://localhost:4000/2012/03/29/things-i-should-have-known-fndoc-availableurl/" title="Share on Twitter" rel="nofollow" target="_blank">Twitter</a>
          <a href="https://facebook.com/sharer.php?u=http://localhost:4000/2012/03/29/things-i-should-have-known-fndoc-availableurl/" title="Share on Facebook" rel="nofollow" target="_blank">Facebook</a>
          <a href="https://plus.google.com/share?url=http://localhost:4000/2012/03/29/things-i-should-have-known-fndoc-availableurl/" title="Share on Google+" rel="nofollow" target="_blank">Google+</a>
        </div>
        <div class="page-tag">
          
            <a href="/tags#filtering" class="tag">&#35; filtering</a>
          
            <a href="/tags#MarkLogic" class="tag">&#35; MarkLogic</a>
          
            <a href="/tags#performance" class="tag">&#35; performance</a>
          
            <a href="/tags#XQuery" class="tag">&#35; XQuery</a>
          
        </div>
      </div>
      <section class="comment-area">
  <div class="comment-wrapper">
    
  </div>
</section> <!-- End Comment Area -->

    </div> <!-- End Wrap Content -->
  </div> <!-- End Page Content -->
</article> <!-- End Article Page -->

</div>

  </div>
  
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-27466203-1', 'auto');
  ga('send', 'pageview');
</script> <!-- End Analytics -->

</body>
</html>
